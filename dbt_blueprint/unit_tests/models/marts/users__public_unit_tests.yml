unit_tests:
  - name: test__users__phone_number_masking
    description: "Test that phone numbers are masked correctly."
    model: users__public
    given:
      - input: ref('int_user_events')
        rows:
          # A best practice is to strictly only include the columns needed for the test case
          - {user_id: 1, phone_number: 12345678, age: 30}
          - {user_id: 2, phone_number: 98765432, age: 30}
          - {user_id: 3, phone_number: null, age: 30}
    expect:
      rows:
        - {user_id: 1, phone_number_masked: '123****78'}
        - {user_id: 2, phone_number_masked: '987****32'}
        - {user_id: 3, phone_number_masked: null}

  - name: test__users__age_filtering
    description: "Test that only users aged 18 or older are included."
    model: users__public
    given:
      - input: ref('int_user_events')
        rows:
          - {user_id: 1, age: 17}
          - {user_id: 2, age: 18}
    expect:
      rows:
        - {user_id: 2}

  - name: test__users__excluded_columns
    description: "Test that the 'age' column is excluded from the final output."
    model: users__public
    given:
      - input: ref('int_user_events')
        rows:
          - {user_id: 1, age: 25, first_name: 'Lucas'}
    expect:
      rows:
        - {user_id: 1, first_name: 'Lucas'}