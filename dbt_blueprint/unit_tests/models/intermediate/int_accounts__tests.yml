unit_tests:
  - name: test__int_accounts__basic_scd_logic
    description: "Test the basic SCD logic for transitioning between active and inactive statuses for multiple accounts."
    model: int_accounts
    given:
      - input: ref('stg_account_events')
        rows:
          - {payment_source_id: 'account_1', status: 'active', recorded_time: '2023-01-01 01:00:00'}
          - {payment_source_id: 'account_1', status: 'inactive', recorded_time: '2023-06-01 01:00:00'}
          - {payment_source_id: 'account_2', status: 'active', recorded_time: '2023-01-01 01:00:00'}
    expect:
      rows:
        - {payment_source_id: 'account_1', status: 'active', from_timestamp: '2023-01-01 01:00:00', to_timestamp: '2023-06-01 01:00:00', is_current: false}
        - {payment_source_id: 'account_1', status: 'inactive', from_timestamp: '2023-06-01 01:00:00', to_timestamp: '9999-12-31 23:59:59', is_current: true}
        - {payment_source_id: 'account_2', status: 'active', from_timestamp: '2023-01-01 01:00:00', to_timestamp: '9999-12-31 23:59:59', is_current: true}

  - name: test__int_accounts__multiple_status_transitions
    description: "Test multiple status transitions for a single account, ensuring correct from_timestamp and to_timestamp values."
    model: int_accounts
    given:
      - input: ref('stg_account_events')
        rows:
          - {payment_source_id: 'account_3', status: 'active', recorded_time: '2023-02-01 01:00:00'}
          - {payment_source_id: 'account_3', status: 'updated', recorded_time: '2023-08-01 01:00:00'}
          - {payment_source_id: 'account_3', status: 'inactive', recorded_time: '2024-02-01 01:00:00'}
    expect:
      rows:
        - {payment_source_id: 'account_3', status: 'active', from_timestamp: '2023-02-01 01:00:00', to_timestamp: '2023-08-01 01:00:00', is_current: false}
        - {payment_source_id: 'account_3', status: 'updated', from_timestamp: '2023-08-01 01:00:00', to_timestamp: '2024-02-01 01:00:00', is_current: false}
        - {payment_source_id: 'account_3', status: 'inactive', from_timestamp: '2024-02-01 01:00:00', to_timestamp: '9999-12-31 23:59:59', is_current: true}

  - name: test__int_accounts__new_account_creation
    description: "Test the creation of a new account with no prior history."
    model: int_accounts
    given:
      - input: ref('stg_account_events')
        rows:
          - {payment_source_id: 'account_4', status: 'active', recorded_time: '2023-03-01 01:00:00'}
    expect:
      rows:
        - {payment_source_id: 'account_4', status: 'active', from_timestamp: '2023-03-01 01:00:00', to_timestamp: '9999-12-31 23:59:59', is_current: true}