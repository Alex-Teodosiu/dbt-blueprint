unit_tests:
  - name: test__int_transactions__union_all
    description: "Test that all transaction types (p2b_captured, p2b_failed, p2p_captured, p2p_failed) are correctly unioned into the int_transactions model."
    model: int_transactions
    given:
      - input: ref('stg_p2b_captured')
        rows:
          - {transaction_event_id: '1', sender_user_id: 'user_1', receiver_user_id: 'user_2', transaction_amount: 100.0, event_time: '2023-01-01 00:00:00', recorded_time: '2023-01-01 01:00:00'}
      - input: ref('stg_p2b_failed')
        rows:
          - {transaction_event_id: '2', sender_user_id: 'user_3', receiver_user_id: 'user_4', transaction_amount: 50.0, event_time: '2023-01-02 00:00:00', recorded_time: '2023-01-02 01:00:00'}
      - input: ref('stg_p2p_captured')
        rows:
          - {transaction_event_id: '3', sender_user_id: 'user_5', receiver_user_id: 'user_6', transaction_amount: 200.0, event_time: '2023-01-03 00:00:00', recorded_time: '2023-01-03 01:00:00'}
      - input: ref('stg_p2p_failed')
        rows:
          - {transaction_event_id: '4', sender_user_id: 'user_7', receiver_user_id: 'user_8', transaction_amount: 75.0, event_time: '2023-01-04 00:00:00', recorded_time: '2023-01-04 01:00:00'}
    expect:
      rows:
        - {event_domain: 'p2b', event_state: 'captured', event_id_raw: '1', sender_user_id: 'user_1', receiver_user_id: 'user_2', transaction_amount: 100.0, event_time: '2023-01-01 00:00:00', recorded_time: '2023-01-01 01:00:00'}
        - {event_domain: 'p2b', event_state: 'failed', event_id_raw: '2', sender_user_id: 'user_3', receiver_user_id: 'user_4', transaction_amount: 50.0, event_time: '2023-01-02 00:00:00', recorded_time: '2023-01-02 01:00:00'}
        - {event_domain: 'p2p', event_state: 'captured', event_id_raw: '3', sender_user_id: 'user_5', receiver_user_id: 'user_6', transaction_amount: 200.0, event_time: '2023-01-03 00:00:00', recorded_time: '2023-01-03 01:00:00'}
        - {event_domain: 'p2p', event_state: 'failed', event_id_raw: '4', sender_user_id: 'user_7', receiver_user_id: 'user_8', transaction_amount: 75.0, event_time: '2023-01-04 00:00:00', recorded_time: '2023-01-04 01:00:00'}

  - name: test__int_transactions__empty_inputs
    description: "Test that the int_transactions model returns no rows when all input staging tables are empty."
    model: int_transactions
    given:
      - input: ref('stg_p2b_captured')
        rows: []
      - input: ref('stg_p2b_failed')
        rows: []
      - input: ref('stg_p2p_captured')
        rows: []
      - input: ref('stg_p2p_failed')
        rows: []
    expect:
      rows: []
